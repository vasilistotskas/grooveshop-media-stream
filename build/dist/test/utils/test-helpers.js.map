{"version":3,"sources":["../../../../src/test/utils/test-helpers.ts"],"sourcesContent":["import type { INestApplication } from '@nestjs/common'\r\nimport * as process from 'node:process'\r\n\r\n/**\r\n * Utility to help with graceful app shutdown in tests\r\n */\r\nexport async function gracefulShutdown(app: INestApplication, delay = 100): Promise<void> {\r\n\tif (!app)\r\n\t\treturn\r\n\r\n\t// Add delay to allow pending requests to complete\r\n\tawait new Promise(resolve => setTimeout(resolve, delay))\r\n\r\n\ttry {\r\n\t\tawait app.close()\r\n\t}\r\n\tcatch (error) {\r\n\t\tconsole.warn('Error during app shutdown:', error)\r\n\t}\r\n}\r\n\r\n/**\r\n * Utility to create staggered requests to reduce server load\r\n */\r\nexport function createStaggeredRequests<T>(\r\n\trequestFactory: (index: number) => Promise<T>,\r\n\tcount: number,\r\n\tstaggerMs = 10,\r\n): Promise<T>[] {\r\n\treturn Array.from({ length: count }, (_, i) =>\r\n\t\tnew Promise<T>((resolve) => {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tresolve(requestFactory(i))\r\n\t\t\t}, i * staggerMs)\r\n\t\t}))\r\n}\r\n\r\n/**\r\n * Get CI-friendly request count\r\n */\r\nexport function getCIFriendlyCount(normalCount: number, ciCount?: number): number {\r\n\treturn process.env.CI ? (ciCount ?? Math.ceil(normalCount / 2)) : normalCount\r\n}\r\n"],"names":["process","gracefulShutdown","app","delay","Promise","resolve","setTimeout","close","error","console","warn","createStaggeredRequests","requestFactory","count","staggerMs","Array","from","length","_","i","getCIFriendlyCount","normalCount","ciCount","env","CI","Math","ceil"],"mappings":"AACA,YAAYA,aAAa,eAAc;AAEvC;;CAEC,GACD,OAAO,eAAeC,iBAAiBC,GAAqB,EAAEC,QAAQ,GAAG;IACxE,IAAI,CAACD,KACJ;IAED,kDAAkD;IAClD,MAAM,IAAIE,QAAQC,CAAAA,UAAWC,WAAWD,SAASF;IAEjD,IAAI;QACH,MAAMD,IAAIK,KAAK;IAChB,EACA,OAAOC,OAAO;QACbC,QAAQC,IAAI,CAAC,8BAA8BF;IAC5C;AACD;AAEA;;CAEC,GACD,OAAO,SAASG,wBACfC,cAA6C,EAC7CC,KAAa,EACbC,YAAY,EAAE;IAEd,OAAOC,MAAMC,IAAI,CAAC;QAAEC,QAAQJ;IAAM,GAAG,CAACK,GAAGC,IACxC,IAAIf,QAAW,CAACC;YACfC,WAAW;gBACVD,QAAQO,eAAeO;YACxB,GAAGA,IAAIL;QACR;AACF;AAEA;;CAEC,GACD,OAAO,SAASM,mBAAmBC,WAAmB,EAAEC,OAAgB;IACvE,OAAOtB,QAAQuB,GAAG,CAACC,EAAE,GAAIF,WAAWG,KAAKC,IAAI,CAACL,cAAc,KAAMA;AACnE"}
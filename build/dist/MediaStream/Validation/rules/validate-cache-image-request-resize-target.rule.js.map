{"version":3,"sources":["../../../../../src/MediaStream/Validation/rules/validate-cache-image-request-resize-target.rule.ts"],"sourcesContent":["import type CacheImageRequest from '@microservice/API/dto/cache-image-request.dto'\r\nimport RequestedResizeTargetTooLargeException from '@microservice/API/exceptions/requested-resize-target-too-large.exception'\r\nimport { Injectable, Scope } from '@nestjs/common'\r\n\r\n@Injectable({ scope: Scope.REQUEST })\r\nexport default class ValidateCacheImageRequestResizeTargetRule {\r\n\tallowedPixelCount = 7680 * 4320\r\n\r\n\trequest!: CacheImageRequest\r\n\r\n\tpublic async setup(request: CacheImageRequest): Promise<void> {\r\n\t\tthis.request = request\r\n\t}\r\n\r\n\tpublic async apply(): Promise<void> {\r\n\t\tconst { width, height } = this.request.resizeOptions\r\n\r\n\t\tif (width === null || height === null) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst pixelCount = width * height\r\n\r\n\t\tif (pixelCount > this.allowedPixelCount) {\r\n\t\t\tthrow new RequestedResizeTargetTooLargeException(this.request.resizeOptions, this.allowedPixelCount)\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["RequestedResizeTargetTooLargeException","Injectable","Scope","ValidateCacheImageRequestResizeTargetRule","setup","request","apply","width","height","resizeOptions","pixelCount","allowedPixelCount","scope","REQUEST"],"mappings":";;;;;;AACA,OAAOA,4CAA4C,sEAA0E;AAC7H,SAASC,UAAU,EAAEC,KAAK,QAAQ,iBAAgB;AAGnC,IAAA,AAAMC,4CAAN,MAAMA;IAKpB,MAAaC,MAAMC,OAA0B,EAAiB;QAC7D,IAAI,CAACA,OAAO,GAAGA;IAChB;IAEA,MAAaC,QAAuB;QACnC,MAAM,EAAEC,KAAK,EAAEC,MAAM,EAAE,GAAG,IAAI,CAACH,OAAO,CAACI,aAAa;QAEpD,IAAIF,UAAU,QAAQC,WAAW,MAAM;YACtC;QACD;QAEA,MAAME,aAAaH,QAAQC;QAE3B,IAAIE,aAAa,IAAI,CAACC,iBAAiB,EAAE;YACxC,MAAM,IAAIX,uCAAuC,IAAI,CAACK,OAAO,CAACI,aAAa,EAAE,IAAI,CAACE,iBAAiB;QACpG;IACD;;aApBAA,oBAAoB,OAAO;;AAqB5B;AAtBA,SAAqBR,uDAsBpB;;;QAvBaS,OAAOV,MAAMW,OAAO"}
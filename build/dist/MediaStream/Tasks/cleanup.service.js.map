{"version":3,"sources":["../../../../src/MediaStream/Tasks/cleanup.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common'\r\nimport { Cron, CronExpression } from '@nestjs/schedule'\r\nimport * as fs from 'fs/promises'\r\nimport * as path from 'path'\r\n\r\n@Injectable()\r\nexport class CleanupService {\r\n\tprivate readonly logger = new Logger(CleanupService.name)\r\n\r\n\t@Cron(CronExpression.EVERY_DAY_AT_4PM, {\r\n\t\tname: 'cleanup'\r\n\t})\r\n\tasync handleCleanup() {\r\n\t\tconst projectRoot = process.cwd()\r\n\t\tconst directoryPath = path.join(projectRoot, 'storage')\r\n\t\tlet deletedFilesCount = 0\r\n\r\n\t\ttry {\r\n\t\t\tconst files = await fs.readdir(directoryPath)\r\n\t\t\tfor (const file of files) {\r\n\t\t\t\tif (file.endsWith('.rst') || file.endsWith('.rsc') || file.endsWith('.rsm')) {\r\n\t\t\t\t\tawait fs.unlink(path.join(directoryPath, file))\r\n\t\t\t\t\tdeletedFilesCount++\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.logger.log(`${deletedFilesCount} files deleted.`)\r\n\t\t} catch (err) {\r\n\t\t\tthis.logger.error(`Error during cleanup: ${err}`)\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["CleanupService","handleCleanup","projectRoot","process","cwd","directoryPath","path","join","deletedFilesCount","files","fs","readdir","file","endsWith","unlink","logger","log","err","error","Logger","name","Cron","CronExpression","EVERY_DAY_AT_4PM","Injectable"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBANsB;0BACE;kEACjB;8DACE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGf,IAAA,AAAMA,iBAAN,MAAMA;IAGZ,MAGMC,gBAAgB;QACrB,MAAMC,cAAcC,QAAQC,GAAG;QAC/B,MAAMC,gBAAgBC,MAAKC,IAAI,CAACL,aAAa;QAC7C,IAAIM,oBAAoB;QAExB,IAAI;YACH,MAAMC,QAAQ,MAAMC,UAAGC,OAAO,CAACN;YAC/B,KAAK,MAAMO,QAAQH,MAAO;gBACzB,IAAIG,KAAKC,QAAQ,CAAC,WAAWD,KAAKC,QAAQ,CAAC,WAAWD,KAAKC,QAAQ,CAAC,SAAS;oBAC5E,MAAMH,UAAGI,MAAM,CAACR,MAAKC,IAAI,CAACF,eAAeO;oBACzCJ;gBACD;YACD;YACA,IAAI,CAACO,MAAM,CAACC,GAAG,CAAC,CAAC,EAAER,kBAAkB,eAAe,CAAC;QACtD,EAAE,OAAOS,KAAK;YACb,IAAI,CAACF,MAAM,CAACG,KAAK,CAAC,CAAC,sBAAsB,EAAED,IAAI,CAAC;QACjD;IACD;;aAtBiBF,SAAS,IAAII,cAAM,CAACnB,eAAeoB,IAAI;;AAuBzD;;IArBEC,IAAAA,cAAI,EAACC,wBAAc,CAACC,gBAAgB,EAAE;QACtCH,MAAM;IACP;;;;GALYpB;AAAAA;IADZwB,IAAAA,kBAAU;GACExB"}
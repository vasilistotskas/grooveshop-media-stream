{"version":3,"sources":["../../../../../src/MediaStream/Cache/strategies/cache-key.strategy.ts"],"sourcesContent":["import type { CacheKeyStrategy } from '../interfaces/cache-layer.interface'\r\nimport { createHash } from 'node:crypto'\r\nimport { Injectable } from '@nestjs/common'\r\n\r\n@Injectable()\r\nexport class DefaultCacheKeyStrategy implements CacheKeyStrategy {\r\n\tprivate readonly separator = ':'\r\n\tprivate readonly hashAlgorithm = 'sha256'\r\n\r\n\tgenerateKey(namespace: string, identifier: string, params?: Record<string, any>): string {\r\n\t\tconst parts = [namespace, identifier]\r\n\r\n\t\tif (params && Object.keys(params).length > 0) {\r\n\t\t\tconst sortedParams = Object.keys(params)\r\n\t\t\t\t.sort()\r\n\t\t\t\t.map(key => `${key}=${params[key]}`)\r\n\t\t\t\t.join('&')\r\n\t\t\tparts.push(this.generateHash(sortedParams))\r\n\t\t}\r\n\r\n\t\treturn parts.join(this.separator)\r\n\t}\r\n\r\n\tparseKey(key: string): { namespace: string, identifier: string, params?: Record<string, any> } {\r\n\t\tconst parts = key.split(this.separator)\r\n\r\n\t\tif (parts.length < 2) {\r\n\t\t\tthrow new Error(`Invalid cache key format: ${key}`)\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tnamespace: parts[0],\r\n\t\t\tidentifier: parts[1],\r\n\t\t\tparams: parts.length > 2 ? { hash: parts[2] } : undefined,\r\n\t\t}\r\n\t}\r\n\r\n\tgenerateHash(input: string): string {\r\n\t\treturn createHash(this.hashAlgorithm)\r\n\t\t\t.update(input)\r\n\t\t\t.digest('hex')\r\n\t\t\t.substring(0, 16)\r\n\t}\r\n}\r\n"],"names":["createHash","Injectable","DefaultCacheKeyStrategy","generateKey","namespace","identifier","params","parts","Object","keys","length","sortedParams","sort","map","key","join","push","generateHash","separator","parseKey","split","Error","hash","undefined","input","hashAlgorithm","update","digest","substring"],"mappings":";;;;;;AACA,SAASA,UAAU,QAAQ,cAAa;AACxC,SAASC,UAAU,QAAQ,iBAAgB;AAG3C,OAAO,MAAMC;IAIZC,YAAYC,SAAiB,EAAEC,UAAkB,EAAEC,MAA4B,EAAU;QACxF,MAAMC,QAAQ;YAACH;YAAWC;SAAW;QAErC,IAAIC,UAAUE,OAAOC,IAAI,CAACH,QAAQI,MAAM,GAAG,GAAG;YAC7C,MAAMC,eAAeH,OAAOC,IAAI,CAACH,QAC/BM,IAAI,GACJC,GAAG,CAACC,CAAAA,MAAO,GAAGA,IAAI,CAAC,EAAER,MAAM,CAACQ,IAAI,EAAE,EAClCC,IAAI,CAAC;YACPR,MAAMS,IAAI,CAAC,IAAI,CAACC,YAAY,CAACN;QAC9B;QAEA,OAAOJ,MAAMQ,IAAI,CAAC,IAAI,CAACG,SAAS;IACjC;IAEAC,SAASL,GAAW,EAA2E;QAC9F,MAAMP,QAAQO,IAAIM,KAAK,CAAC,IAAI,CAACF,SAAS;QAEtC,IAAIX,MAAMG,MAAM,GAAG,GAAG;YACrB,MAAM,IAAIW,MAAM,CAAC,0BAA0B,EAAEP,KAAK;QACnD;QAEA,OAAO;YACNV,WAAWG,KAAK,CAAC,EAAE;YACnBF,YAAYE,KAAK,CAAC,EAAE;YACpBD,QAAQC,MAAMG,MAAM,GAAG,IAAI;gBAAEY,MAAMf,KAAK,CAAC,EAAE;YAAC,IAAIgB;QACjD;IACD;IAEAN,aAAaO,KAAa,EAAU;QACnC,OAAOxB,WAAW,IAAI,CAACyB,aAAa,EAClCC,MAAM,CAACF,OACPG,MAAM,CAAC,OACPC,SAAS,CAAC,GAAG;IAChB;;aApCiBV,YAAY;aACZO,gBAAgB;;AAoClC"}
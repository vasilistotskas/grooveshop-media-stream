import type { ResizeOptions } from '@microservice/API/dto/cache-image-request.dto';
import type { ResourceIdentifierKP } from '@microservice/common/constants/key-properties.constant';
import { Buffer } from 'node:buffer';
import CacheImageRequest from '@microservice/API/dto/cache-image-request.dto';
import { MultiLayerCacheManager } from '@microservice/Cache/services/multi-layer-cache.manager';
import ResourceMetaData from '@microservice/HTTP/dto/resource-meta-data.dto';
import { MetricsService } from '@microservice/Metrics/services/metrics.service';
import FetchResourceResponseJob from '@microservice/Queue/jobs/fetch-resource-response.job';
import GenerateResourceIdentityFromRequestJob from '@microservice/Queue/jobs/generate-resource-identity-from-request.job';
import StoreResourceResponseToFileJob from '@microservice/Queue/jobs/store-resource-response-to-file.job';
import WebpImageManipulationJob from '@microservice/Queue/jobs/webp-image-manipulation.job';
import { JobQueueManager } from '@microservice/Queue/services/job-queue.manager';
import ValidateCacheImageRequestRule from '@microservice/Validation/rules/validate-cache-image-request.rule';
import { InputSanitizationService } from '@microservice/Validation/services/input-sanitization.service';
export default class CacheImageResourceOperation {
    private readonly validateCacheImageRequest;
    private readonly fetchResourceResponseJob;
    private readonly webpImageManipulationJob;
    private readonly storeResourceResponseToFileJob;
    private readonly generateResourceIdentityFromRequestJob;
    private readonly cacheManager;
    private readonly inputSanitizationService;
    private readonly jobQueueManager;
    private readonly metricsService;
    private readonly basePath;
    constructor(validateCacheImageRequest: ValidateCacheImageRequestRule, fetchResourceResponseJob: FetchResourceResponseJob, webpImageManipulationJob: WebpImageManipulationJob, storeResourceResponseToFileJob: StoreResourceResponseToFileJob, generateResourceIdentityFromRequestJob: GenerateResourceIdentityFromRequestJob, cacheManager: MultiLayerCacheManager, inputSanitizationService: InputSanitizationService, jobQueueManager: JobQueueManager, metricsService: MetricsService);
    request: CacheImageRequest;
    id: ResourceIdentifierKP;
    metaData: ResourceMetaData;
    get getResourcePath(): string;
    get getResourceTempPath(): string;
    get getResourceMetaPath(): string;
    get resourceExists(): Promise<boolean>;
    get getHeaders(): Promise<ResourceMetaData>;
    setup(cacheImageRequest: CacheImageRequest): Promise<void>;
    execute(): Promise<void>;
    shouldUseBackgroundProcessing(): boolean;
    private queueImageProcessing;
    private processImageSynchronously;
    private processSvgImage;
    private processRasterImage;
    private processDefaultImage;
    private getFormatFromUrl;
    optimizeAndServeDefaultImage(resizeOptions: ResizeOptions): Promise<string>;
    private createOptionsString;
    getCachedResource(): Promise<{
        data: Buffer;
        metadata: ResourceMetaData;
    } | null>;
}

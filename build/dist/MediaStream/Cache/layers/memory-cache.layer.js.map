{"version":3,"sources":["../../../../../src/MediaStream/Cache/layers/memory-cache.layer.ts"],"sourcesContent":["import type { CacheLayer, CacheLayerStats } from '../interfaces/cache-layer.interface'\r\nimport { Injectable } from '@nestjs/common'\r\nimport { MemoryCacheService } from '../services/memory-cache.service'\r\n\r\n@Injectable()\r\nexport class MemoryCacheLayer implements CacheLayer {\r\n\tprivate readonly layerName = 'memory'\r\n\tprivate readonly priority = 1\r\n\r\n\tconstructor(private readonly memoryCacheService: MemoryCacheService) {}\r\n\r\n\tasync get<T>(key: string): Promise<T | null> {\r\n\t\treturn this.memoryCacheService.get<T>(key)\r\n\t}\r\n\r\n\tasync set<T>(key: string, value: T, ttl?: number): Promise<void> {\r\n\t\tawait this.memoryCacheService.set(key, value, ttl)\r\n\t}\r\n\r\n\tasync delete(key: string): Promise<void> {\r\n\t\tawait this.memoryCacheService.delete(key)\r\n\t}\r\n\r\n\tasync exists(key: string): Promise<boolean> {\r\n\t\treturn this.memoryCacheService.has(key)\r\n\t}\r\n\r\n\tasync clear(): Promise<void> {\r\n\t\tawait this.memoryCacheService.clear()\r\n\t}\r\n\r\n\tasync getStats(): Promise<CacheLayerStats> {\r\n\t\tconst stats = await this.memoryCacheService.getStats()\r\n\t\treturn {\r\n\t\t\thits: stats.hits,\r\n\t\t\tmisses: stats.misses,\r\n\t\t\tkeys: stats.keys,\r\n\t\t\thitRate: stats.hitRate,\r\n\t\t\tmemoryUsage: stats.memoryUsage || (stats.vsize + stats.ksize),\r\n\t\t\terrors: 0,\r\n\t\t}\r\n\t}\r\n\r\n\tgetLayerName(): string {\r\n\t\treturn this.layerName\r\n\t}\r\n\r\n\tgetPriority(): number {\r\n\t\treturn this.priority\r\n\t}\r\n}\r\n"],"names":["Injectable","MemoryCacheService","MemoryCacheLayer","get","key","memoryCacheService","set","value","ttl","delete","exists","has","clear","getStats","stats","hits","misses","keys","hitRate","memoryUsage","vsize","ksize","errors","getLayerName","layerName","getPriority","priority"],"mappings":";;;;;;;;;AACA,SAASA,UAAU,QAAQ,iBAAgB;AAC3C,SAASC,kBAAkB,QAAQ,sCAAkC;AAGrE,OAAO,MAAMC;IAMZ,MAAMC,IAAOC,GAAW,EAAqB;QAC5C,OAAO,IAAI,CAACC,kBAAkB,CAACF,GAAG,CAAIC;IACvC;IAEA,MAAME,IAAOF,GAAW,EAAEG,KAAQ,EAAEC,GAAY,EAAiB;QAChE,MAAM,IAAI,CAACH,kBAAkB,CAACC,GAAG,CAACF,KAAKG,OAAOC;IAC/C;IAEA,MAAMC,OAAOL,GAAW,EAAiB;QACxC,MAAM,IAAI,CAACC,kBAAkB,CAACI,MAAM,CAACL;IACtC;IAEA,MAAMM,OAAON,GAAW,EAAoB;QAC3C,OAAO,IAAI,CAACC,kBAAkB,CAACM,GAAG,CAACP;IACpC;IAEA,MAAMQ,QAAuB;QAC5B,MAAM,IAAI,CAACP,kBAAkB,CAACO,KAAK;IACpC;IAEA,MAAMC,WAAqC;QAC1C,MAAMC,QAAQ,MAAM,IAAI,CAACT,kBAAkB,CAACQ,QAAQ;QACpD,OAAO;YACNE,MAAMD,MAAMC,IAAI;YAChBC,QAAQF,MAAME,MAAM;YACpBC,MAAMH,MAAMG,IAAI;YAChBC,SAASJ,MAAMI,OAAO;YACtBC,aAAaL,MAAMK,WAAW,IAAKL,MAAMM,KAAK,GAAGN,MAAMO,KAAK;YAC5DC,QAAQ;QACT;IACD;IAEAC,eAAuB;QACtB,OAAO,IAAI,CAACC,SAAS;IACtB;IAEAC,cAAsB;QACrB,OAAO,IAAI,CAACC,QAAQ;IACrB;IAxCA,YAAY,AAAiBrB,kBAAsC,CAAE;aAAxCA,qBAAAA;aAHZmB,YAAY;aACZE,WAAW;IAE0C;AAyCvE"}
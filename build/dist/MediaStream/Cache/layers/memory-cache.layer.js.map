{"version":3,"sources":["../../../../../src/MediaStream/Cache/layers/memory-cache.layer.ts"],"sourcesContent":["import type { CacheLayer, CacheLayerStats } from '../interfaces/cache-layer.interface'\r\nimport { Injectable } from '@nestjs/common'\r\nimport { MemoryCacheService } from '../services/memory-cache.service'\r\n\r\n@Injectable()\r\nexport class MemoryCacheLayer implements CacheLayer {\r\n\tprivate readonly layerName = 'memory'\r\n\tprivate readonly priority = 1\r\n\r\n\tconstructor(private readonly memoryCacheService: MemoryCacheService) {}\r\n\r\n\tasync get<T>(key: string): Promise<T | null> {\r\n\t\treturn this.memoryCacheService.get<T>(key)\r\n\t}\r\n\r\n\tasync set<T>(key: string, value: T, ttl?: number): Promise<void> {\r\n\t\tawait this.memoryCacheService.set(key, value, ttl)\r\n\t}\r\n\r\n\tasync delete(key: string): Promise<void> {\r\n\t\tawait this.memoryCacheService.delete(key)\r\n\t}\r\n\r\n\tasync exists(key: string): Promise<boolean> {\r\n\t\treturn this.memoryCacheService.has(key)\r\n\t}\r\n\r\n\tasync clear(): Promise<void> {\r\n\t\tawait this.memoryCacheService.clear()\r\n\t}\r\n\r\n\tasync getStats(): Promise<CacheLayerStats> {\r\n\t\tconst stats = await this.memoryCacheService.getStats()\r\n\t\treturn {\r\n\t\t\thits: stats.hits,\r\n\t\t\tmisses: stats.misses,\r\n\t\t\tkeys: stats.keys,\r\n\t\t\thitRate: stats.hitRate,\r\n\t\t\tmemoryUsage: stats.memoryUsage || (stats.vsize + stats.ksize),\r\n\t\t\terrors: 0,\r\n\t\t}\r\n\t}\r\n\r\n\tgetLayerName(): string {\r\n\t\treturn this.layerName\r\n\t}\r\n\r\n\tgetPriority(): number {\r\n\t\treturn this.priority\r\n\t}\r\n}\r\n"],"names":["Injectable","MemoryCacheService","MemoryCacheLayer","memoryCacheService","layerName","priority","get","key","set","value","ttl","delete","exists","has","clear","getStats","stats","hits","misses","keys","hitRate","memoryUsage","vsize","ksize","errors","getLayerName","getPriority"],"mappings":";;;;;;;;;AACA,SAASA,UAAU,QAAQ,iBAAgB;AAC3C,SAASC,kBAAkB,QAAQ,sCAAkC;AAGrE,OAAO,MAAMC;IAIZ,YAAY,AAAiBC,kBAAsC,CAAE;aAAxCA,qBAAAA;aAHZC,YAAY;aACZC,WAAW;IAE0C;IAEtE,MAAMC,IAAOC,GAAW,EAAqB;QAC5C,OAAO,IAAI,CAACJ,kBAAkB,CAACG,GAAG,CAAIC;IACvC;IAEA,MAAMC,IAAOD,GAAW,EAAEE,KAAQ,EAAEC,GAAY,EAAiB;QAChE,MAAM,IAAI,CAACP,kBAAkB,CAACK,GAAG,CAACD,KAAKE,OAAOC;IAC/C;IAEA,MAAMC,OAAOJ,GAAW,EAAiB;QACxC,MAAM,IAAI,CAACJ,kBAAkB,CAACQ,MAAM,CAACJ;IACtC;IAEA,MAAMK,OAAOL,GAAW,EAAoB;QAC3C,OAAO,IAAI,CAACJ,kBAAkB,CAACU,GAAG,CAACN;IACpC;IAEA,MAAMO,QAAuB;QAC5B,MAAM,IAAI,CAACX,kBAAkB,CAACW,KAAK;IACpC;IAEA,MAAMC,WAAqC;QAC1C,MAAMC,QAAQ,MAAM,IAAI,CAACb,kBAAkB,CAACY,QAAQ;QACpD,OAAO;YACNE,MAAMD,MAAMC,IAAI;YAChBC,QAAQF,MAAME,MAAM;YACpBC,MAAMH,MAAMG,IAAI;YAChBC,SAASJ,MAAMI,OAAO;YACtBC,aAAaL,MAAMK,WAAW,IAAKL,MAAMM,KAAK,GAAGN,MAAMO,KAAK;YAC5DC,QAAQ;QACT;IACD;IAEAC,eAAuB;QACtB,OAAO,IAAI,CAACrB,SAAS;IACtB;IAEAsB,cAAsB;QACrB,OAAO,IAAI,CAACrB,QAAQ;IACrB;AACD"}
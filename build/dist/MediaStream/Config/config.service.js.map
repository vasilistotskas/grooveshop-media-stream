{"version":3,"sources":["../../../../src/MediaStream/Config/config.service.ts"],"sourcesContent":["import type { AppConfig } from '@microservice/Config/interfaces/app-config.interface'\r\nimport type { OnModuleInit } from '@nestjs/common'\r\nimport { Injectable, Logger } from '@nestjs/common'\r\nimport { ConfigService as NestConfigService } from '@nestjs/config'\r\n\r\n@Injectable()\r\nexport class ConfigService implements OnModuleInit {\r\n\tprivate readonly _logger = new Logger(ConfigService.name)\r\n\tprivate config: AppConfig\r\n\tprivate readonly hotReloadableKeys = new Set([\r\n\t\t'MONITORING_ENABLED',\r\n\t\t'PROCESSING_MAX_CONCURRENT',\r\n\t\t'CACHE_MEMORY_TTL',\r\n\t\t'CACHE_FILE_CLEANUP_INTERVAL',\r\n\t])\r\n\r\n\tconstructor(private readonly nestConfigService: NestConfigService) {\r\n\t\tthis.config = this.loadAndValidateConfig()\r\n\t}\r\n\r\n\tasync onModuleInit(): Promise<void> {\r\n\t\tthis._logger.log('Configuration loaded and validated successfully')\r\n\t}\r\n\r\n\t/**\r\n\t * Get a configuration value by key with type safety\r\n\t */\r\n\tget<T = any>(key: string): T {\r\n\t\tconst keys = key.split('.')\r\n\t\tlet value: any = this.config\r\n\r\n\t\tfor (const k of keys) {\r\n\t\t\tvalue = value?.[k]\r\n\t\t}\r\n\r\n\t\tif (value === undefined) {\r\n\t\t\tthrow new Error(`Configuration key '${key}' not found`)\r\n\t\t}\r\n\r\n\t\treturn value as T\r\n\t}\r\n\r\n\t/**\r\n\t * Get an optional configuration value with default fallback\r\n\t */\r\n\tgetOptional<T = any>(key: string, defaultValue?: T): T {\r\n\t\ttry {\r\n\t\t\treturn this.get<T>(key)\r\n\t\t}\r\n\t\tcatch {\r\n\t\t\treturn defaultValue as T\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get the entire configuration object\r\n\t */\r\n\tgetAll(): AppConfig {\r\n\t\treturn { ...this.config }\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the current configuration\r\n\t */\r\n\tasync validate(): Promise<void> {\r\n\t\tconst { plainToClass } = await import('class-transformer')\r\n\t\tconst { validate } = await import('class-validator')\r\n\t\tconst { AppConfigDto } = await import('@microservice/Config/dto/app-config.dto')\r\n\r\n\t\tconst rawConfig = this.createRawConfigForValidation()\r\n\r\n\t\tconst dto = plainToClass(AppConfigDto, rawConfig, {\r\n\t\t\tenableImplicitConversion: true,\r\n\t\t\texcludeExtraneousValues: false,\r\n\t\t})\r\n\t\tconst errors = await validate(dto, {\r\n\t\t\twhitelist: false,\r\n\t\t\tforbidNonWhitelisted: false,\r\n\t\t})\r\n\r\n\t\tif (errors.length > 0) {\r\n\t\t\tconst errorMessages = errors.map(error =>\r\n\t\t\t\tObject.values(error.constraints || {}).join(', '),\r\n\t\t\t).join('; ')\r\n\t\t\tthrow new Error(`Configuration validation failed: ${errorMessages}`)\r\n\t\t}\r\n\r\n\t\tthis._logger.log('Configuration validation passed')\r\n\t}\r\n\r\n\t/**\r\n\t * Create raw configuration object for validation\r\n\t */\r\n\tprivate createRawConfigForValidation(): Record<string, any> {\r\n\t\treturn {\r\n\t\t\tserver: {\r\n\t\t\t\tport: this.nestConfigService.get('PORT'),\r\n\t\t\t\thost: this.nestConfigService.get('HOST'),\r\n\t\t\t\tcors: {\r\n\t\t\t\t\torigin: this.nestConfigService.get('CORS_ORIGIN'),\r\n\t\t\t\t\tmethods: this.nestConfigService.get('CORS_METHODS'),\r\n\t\t\t\t\tmaxAge: this.nestConfigService.get('CORS_MAX_AGE'),\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tcache: {\r\n\t\t\t\tmemory: {\r\n\t\t\t\t\tmaxSize: this.nestConfigService.get('CACHE_MEMORY_MAX_SIZE'),\r\n\t\t\t\t\tdefaultTtl: this.nestConfigService.get('CACHE_MEMORY_DEFAULT_TTL'),\r\n\t\t\t\t\tcheckPeriod: this.nestConfigService.get('CACHE_MEMORY_CHECK_PERIOD'),\r\n\t\t\t\t\tmaxKeys: this.nestConfigService.get('CACHE_MEMORY_MAX_KEYS'),\r\n\t\t\t\t\twarningThreshold: this.nestConfigService.get('CACHE_MEMORY_WARNING_THRESHOLD'),\r\n\t\t\t\t},\r\n\t\t\t\tredis: {\r\n\t\t\t\t\thost: this.nestConfigService.get('REDIS_HOST'),\r\n\t\t\t\t\tport: this.nestConfigService.get('REDIS_PORT'),\r\n\t\t\t\t\tpassword: this.nestConfigService.get('REDIS_PASSWORD'),\r\n\t\t\t\t\tdb: this.nestConfigService.get('REDIS_DB'),\r\n\t\t\t\t\tttl: this.nestConfigService.get('REDIS_TTL'),\r\n\t\t\t\t\tmaxRetries: this.nestConfigService.get('REDIS_MAX_RETRIES'),\r\n\t\t\t\t\tretryDelayOnFailover: this.nestConfigService.get('REDIS_RETRY_DELAY'),\r\n\t\t\t\t},\r\n\t\t\t\tfile: {\r\n\t\t\t\t\tdirectory: this.nestConfigService.get('CACHE_FILE_DIRECTORY'),\r\n\t\t\t\t\tmaxSize: this.nestConfigService.get('CACHE_FILE_MAX_SIZE'),\r\n\t\t\t\t\tcleanupInterval: this.nestConfigService.get('CACHE_FILE_CLEANUP_INTERVAL'),\r\n\t\t\t\t},\r\n\t\t\t\twarming: {\r\n\t\t\t\t\tenabled: this.nestConfigService.get('CACHE_WARMING_ENABLED'),\r\n\t\t\t\t\twarmupOnStart: this.nestConfigService.get('CACHE_WARMING_ON_START'),\r\n\t\t\t\t\tmaxFilesToWarm: this.nestConfigService.get('CACHE_WARMING_MAX_FILES'),\r\n\t\t\t\t\twarmupCron: this.nestConfigService.get('CACHE_WARMING_CRON'),\r\n\t\t\t\t\tpopularImageThreshold: this.nestConfigService.get('CACHE_WARMING_THRESHOLD'),\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tprocessing: {\r\n\t\t\t\tmaxConcurrent: this.nestConfigService.get('PROCESSING_MAX_CONCURRENT'),\r\n\t\t\t\ttimeout: this.nestConfigService.get('PROCESSING_TIMEOUT'),\r\n\t\t\t\tretries: this.nestConfigService.get('PROCESSING_RETRIES'),\r\n\t\t\t\tmaxFileSize: this.nestConfigService.get('PROCESSING_MAX_FILE_SIZE'),\r\n\t\t\t\tallowedFormats: this.nestConfigService.get('PROCESSING_ALLOWED_FORMATS'),\r\n\t\t\t},\r\n\t\t\tmonitoring: {\r\n\t\t\t\tenabled: this.nestConfigService.get('MONITORING_ENABLED'),\r\n\t\t\t\tmetricsPort: this.nestConfigService.get('MONITORING_METRICS_PORT'),\r\n\t\t\t\thealthPath: this.nestConfigService.get('MONITORING_HEALTH_PATH'),\r\n\t\t\t\tmetricsPath: this.nestConfigService.get('MONITORING_METRICS_PATH'),\r\n\t\t\t},\r\n\t\t\texternalServices: {\r\n\t\t\t\tdjangoUrl: this.nestConfigService.get('NEST_PUBLIC_DJANGO_URL'),\r\n\t\t\t\tnuxtUrl: this.nestConfigService.get('NEST_PUBLIC_NUXT_URL'),\r\n\t\t\t\trequestTimeout: this.nestConfigService.get('EXTERNAL_REQUEST_TIMEOUT'),\r\n\t\t\t\tmaxRetries: this.nestConfigService.get('EXTERNAL_MAX_RETRIES'),\r\n\t\t\t},\r\n\t\t\thttp: {\r\n\t\t\t\ttimeout: this.nestConfigService.get('HTTP_TIMEOUT'),\r\n\t\t\t\tmaxRetries: this.nestConfigService.get('HTTP_MAX_RETRIES'),\r\n\t\t\t\tretryDelay: this.nestConfigService.get('HTTP_RETRY_DELAY'),\r\n\t\t\t\tcircuitBreaker: {\r\n\t\t\t\t\tenabled: this.nestConfigService.get('HTTP_CIRCUIT_BREAKER_ENABLED'),\r\n\t\t\t\t\tfailureThreshold: this.nestConfigService.get('HTTP_CIRCUIT_BREAKER_FAILURE_THRESHOLD'),\r\n\t\t\t\t\tresetTimeout: this.nestConfigService.get('HTTP_CIRCUIT_BREAKER_RESET_TIMEOUT'),\r\n\t\t\t\t},\r\n\t\t\t\thealthCheck: {\r\n\t\t\t\t\tenabled: this.nestConfigService.get('HTTP_HEALTH_CHECK_ENABLED'),\r\n\t\t\t\t\turls: this.nestConfigService.get('HTTP_HEALTH_CHECK_URLS'),\r\n\t\t\t\t\ttimeout: this.nestConfigService.get('HTTP_HEALTH_CHECK_TIMEOUT'),\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\trateLimit: {\r\n\t\t\t\tenabled: this.nestConfigService.get('RATE_LIMIT_ENABLED'),\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\twindowMs: this.nestConfigService.get('RATE_LIMIT_DEFAULT_WINDOW_MS'),\r\n\t\t\t\t\tmax: this.nestConfigService.get('RATE_LIMIT_DEFAULT_MAX'),\r\n\t\t\t\t},\r\n\t\t\t\timageProcessing: {\r\n\t\t\t\t\twindowMs: this.nestConfigService.get('RATE_LIMIT_IMAGE_PROCESSING_WINDOW_MS'),\r\n\t\t\t\t\tmax: this.nestConfigService.get('RATE_LIMIT_IMAGE_PROCESSING_MAX'),\r\n\t\t\t\t},\r\n\t\t\t\thealthCheck: {\r\n\t\t\t\t\twindowMs: this.nestConfigService.get('RATE_LIMIT_HEALTH_CHECK_WINDOW_MS'),\r\n\t\t\t\t\tmax: this.nestConfigService.get('RATE_LIMIT_HEALTH_CHECK_MAX'),\r\n\t\t\t\t},\r\n\t\t\t\tbypass: {\r\n\t\t\t\t\thealthChecks: this.nestConfigService.get('RATE_LIMIT_BYPASS_HEALTH_CHECKS'),\r\n\t\t\t\t\tmetricsEndpoint: this.nestConfigService.get('RATE_LIMIT_BYPASS_METRICS_ENDPOINT'),\r\n\t\t\t\t\tstaticAssets: this.nestConfigService.get('RATE_LIMIT_BYPASS_STATIC_ASSETS'),\r\n\t\t\t\t\twhitelistedDomains: this.nestConfigService.get('RATE_LIMIT_BYPASS_WHITELISTED_DOMAINS'),\r\n\t\t\t\t\tbots: this.nestConfigService.get('RATE_LIMIT_BYPASS_BOTS'),\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reload configuration for hot-reloadable settings\r\n\t */\r\n\tasync reload(): Promise<void> {\r\n\t\tthis._logger.log('Reloading hot-reloadable configuration...')\r\n\r\n\t\tconst newConfig = this.loadConfig()\r\n\r\n\t\tthis.updateHotReloadableSettings(newConfig)\r\n\r\n\t\tthis._logger.log('Hot-reloadable configuration updated successfully')\r\n\t}\r\n\r\n\t/**\r\n\t * Check if a configuration key supports hot-reload\r\n\t */\r\n\tisHotReloadable(key: string): boolean {\r\n\t\treturn this.hotReloadableKeys.has(key)\r\n\t}\r\n\r\n\tprivate loadAndValidateConfig(): AppConfig {\r\n\t\treturn this.loadConfig()\r\n\t}\r\n\r\n\tprivate loadConfig(): AppConfig {\r\n\t\tconst serverPort = Number.parseInt(this.nestConfigService.get('PORT') || '3003')\r\n\t\tconst serverHost = this.nestConfigService.get('HOST') || '0.0.0.0'\r\n\t\tconst corsOrigin = this.nestConfigService.get('CORS_ORIGIN') || '*'\r\n\t\tconst corsMethods = this.nestConfigService.get('CORS_METHODS') || 'GET'\r\n\t\tconst corsMaxAge = Number.parseInt(this.nestConfigService.get('CORS_MAX_AGE') || '86400')\r\n\r\n\t\tconst memoryMaxSize = Number.parseInt(this.nestConfigService.get('CACHE_MEMORY_MAX_SIZE') || '104857600')\r\n\t\tconst memoryDefaultTtl = Number.parseInt(this.nestConfigService.get('CACHE_MEMORY_DEFAULT_TTL') || '3600')\r\n\t\tconst memoryCheckPeriod = Number.parseInt(this.nestConfigService.get('CACHE_MEMORY_CHECK_PERIOD') || '600')\r\n\t\tconst memoryMaxKeys = Number.parseInt(this.nestConfigService.get('CACHE_MEMORY_MAX_KEYS') || '1000')\r\n\t\tconst memoryWarningThreshold = Number.parseInt(this.nestConfigService.get('CACHE_MEMORY_WARNING_THRESHOLD') || '80')\r\n\r\n\t\tconst redisHost = this.nestConfigService.get('REDIS_HOST') || 'localhost'\r\n\t\tconst redisPort = Number.parseInt(this.nestConfigService.get('REDIS_PORT') || '6379')\r\n\t\tconst redisPassword = this.nestConfigService.get('REDIS_PASSWORD')\r\n\t\tconst redisDb = Number.parseInt(this.nestConfigService.get('REDIS_DB') || '0')\r\n\t\tconst redisTtl = Number.parseInt(this.nestConfigService.get('REDIS_TTL') || '7200')\r\n\t\tconst redisMaxRetries = Number.parseInt(this.nestConfigService.get('REDIS_MAX_RETRIES') || '3')\r\n\t\tconst redisRetryDelay = Number.parseInt(this.nestConfigService.get('REDIS_RETRY_DELAY') || '100')\r\n\r\n\t\tconst fileDirectory = this.nestConfigService.get('CACHE_FILE_DIRECTORY') || './storage'\r\n\t\tconst fileMaxSize = Number.parseInt(this.nestConfigService.get('CACHE_FILE_MAX_SIZE') || '1073741824')\r\n\t\tconst fileCleanupInterval = Number.parseInt(this.nestConfigService.get('CACHE_FILE_CLEANUP_INTERVAL') || '3600')\r\n\r\n\t\tconst warmingEnabledStr = this.nestConfigService.get('CACHE_WARMING_ENABLED') || 'true'\r\n\t\tconst warmingEnabled = typeof warmingEnabledStr === 'string'\r\n\t\t\t? warmingEnabledStr.toLowerCase() === 'true'\r\n\t\t\t: warmingEnabledStr\r\n\t\tconst warmingOnStartStr = this.nestConfigService.get('CACHE_WARMING_ON_START') || 'true'\r\n\t\tconst warmingOnStart = typeof warmingOnStartStr === 'string'\r\n\t\t\t? warmingOnStartStr.toLowerCase() === 'true'\r\n\t\t\t: warmingOnStartStr\r\n\t\tconst warmingMaxFiles = Number.parseInt(this.nestConfigService.get('CACHE_WARMING_MAX_FILES') || '50')\r\n\t\tconst warmingCron = this.nestConfigService.get('CACHE_WARMING_CRON') || '0 */6 * * *'\r\n\t\tconst warmingThreshold = Number.parseInt(this.nestConfigService.get('CACHE_WARMING_THRESHOLD') || '5')\r\n\r\n\t\tconst processingMaxConcurrent = Number.parseInt(this.nestConfigService.get('PROCESSING_MAX_CONCURRENT') || '10')\r\n\t\tconst processingTimeout = Number.parseInt(this.nestConfigService.get('PROCESSING_TIMEOUT') || '30000')\r\n\t\tconst processingRetries = Number.parseInt(this.nestConfigService.get('PROCESSING_RETRIES') || '3')\r\n\t\tconst processingMaxFileSize = Number.parseInt(this.nestConfigService.get('PROCESSING_MAX_FILE_SIZE') || '10485760')\r\n\r\n\t\tconst allowedFormatsStr = this.nestConfigService.get('PROCESSING_ALLOWED_FORMATS') || 'jpg,jpeg,png,webp,gif,svg'\r\n\t\tconst allowedFormats = typeof allowedFormatsStr === 'string'\r\n\t\t\t? allowedFormatsStr.split(',').map(format => format.trim().toLowerCase())\r\n\t\t\t: allowedFormatsStr\r\n\r\n\t\tconst monitoringEnabledStr = this.nestConfigService.get('MONITORING_ENABLED') || 'true'\r\n\t\tconst monitoringEnabled = typeof monitoringEnabledStr === 'string'\r\n\t\t\t? monitoringEnabledStr.toLowerCase() === 'true'\r\n\t\t\t: monitoringEnabledStr\r\n\t\tconst monitoringMetricsPort = Number.parseInt(this.nestConfigService.get('MONITORING_METRICS_PORT') || '9090')\r\n\t\tconst monitoringHealthPath = this.nestConfigService.get('MONITORING_HEALTH_PATH') || '/health'\r\n\t\tconst monitoringMetricsPath = this.nestConfigService.get('MONITORING_METRICS_PATH') || '/metrics'\r\n\r\n\t\tconst djangoUrl = this.nestConfigService.get('NEST_PUBLIC_DJANGO_URL') || 'http://localhost:8000'\r\n\t\tconst nuxtUrl = this.nestConfigService.get('NEST_PUBLIC_NUXT_URL') || 'http://localhost:3000'\r\n\t\tconst externalRequestTimeout = Number.parseInt(this.nestConfigService.get('EXTERNAL_REQUEST_TIMEOUT') || '30000')\r\n\t\tconst externalMaxRetries = Number.parseInt(this.nestConfigService.get('EXTERNAL_MAX_RETRIES') || '3')\r\n\r\n\t\tconst rateLimitEnabledStr = this.nestConfigService.get('RATE_LIMIT_ENABLED') || 'true'\r\n\t\tconst rateLimitEnabled = typeof rateLimitEnabledStr === 'string'\r\n\t\t\t? rateLimitEnabledStr.toLowerCase() === 'true'\r\n\t\t\t: rateLimitEnabledStr\r\n\t\tconst rateLimitDefaultWindowMs = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_DEFAULT_WINDOW_MS') || '60000')\r\n\t\tconst rateLimitDefaultMax = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_DEFAULT_MAX') || '100')\r\n\t\tconst rateLimitImageProcessingWindowMs = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_IMAGE_PROCESSING_WINDOW_MS') || '60000')\r\n\t\tconst rateLimitImageProcessingMax = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_IMAGE_PROCESSING_MAX') || '50')\r\n\t\tconst rateLimitHealthCheckWindowMs = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_HEALTH_CHECK_WINDOW_MS') || '10000')\r\n\t\tconst rateLimitHealthCheckMax = Number.parseInt(this.nestConfigService.get('RATE_LIMIT_HEALTH_CHECK_MAX') || '1000')\r\n\r\n\t\tconst rateLimitBypassHealthChecksStr = this.nestConfigService.get('RATE_LIMIT_BYPASS_HEALTH_CHECKS') || 'true'\r\n\t\tconst rateLimitBypassHealthChecks = typeof rateLimitBypassHealthChecksStr === 'string'\r\n\t\t\t? rateLimitBypassHealthChecksStr.toLowerCase() === 'true'\r\n\t\t\t: rateLimitBypassHealthChecksStr\r\n\t\tconst rateLimitBypassMetricsEndpointStr = this.nestConfigService.get('RATE_LIMIT_BYPASS_METRICS_ENDPOINT') || 'true'\r\n\t\tconst rateLimitBypassMetricsEndpoint = typeof rateLimitBypassMetricsEndpointStr === 'string'\r\n\t\t\t? rateLimitBypassMetricsEndpointStr.toLowerCase() === 'true'\r\n\t\t\t: rateLimitBypassMetricsEndpointStr\r\n\t\tconst rateLimitBypassStaticAssetsStr = this.nestConfigService.get('RATE_LIMIT_BYPASS_STATIC_ASSETS') || 'true'\r\n\t\tconst rateLimitBypassStaticAssets = typeof rateLimitBypassStaticAssetsStr === 'string'\r\n\t\t\t? rateLimitBypassStaticAssetsStr.toLowerCase() === 'true'\r\n\t\t\t: rateLimitBypassStaticAssetsStr\r\n\t\tconst rateLimitBypassWhitelistedDomains = this.nestConfigService.get('RATE_LIMIT_BYPASS_WHITELISTED_DOMAINS') || ''\r\n\t\tconst rateLimitBypassBotsStr = this.nestConfigService.get('RATE_LIMIT_BYPASS_BOTS') || 'true'\r\n\t\tconst rateLimitBypassBots = typeof rateLimitBypassBotsStr === 'string'\r\n\t\t\t? rateLimitBypassBotsStr.toLowerCase() === 'true'\r\n\t\t\t: rateLimitBypassBotsStr\r\n\r\n\t\treturn {\r\n\t\t\tserver: {\r\n\t\t\t\tport: serverPort,\r\n\t\t\t\thost: serverHost,\r\n\t\t\t\tcors: {\r\n\t\t\t\t\torigin: corsOrigin,\r\n\t\t\t\t\tmethods: corsMethods,\r\n\t\t\t\t\tmaxAge: corsMaxAge,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tcache: {\r\n\t\t\t\tmemory: {\r\n\t\t\t\t\tmaxSize: memoryMaxSize,\r\n\t\t\t\t\tdefaultTtl: memoryDefaultTtl,\r\n\t\t\t\t\tcheckPeriod: memoryCheckPeriod,\r\n\t\t\t\t\tmaxKeys: memoryMaxKeys,\r\n\t\t\t\t\twarningThreshold: memoryWarningThreshold,\r\n\t\t\t\t},\r\n\t\t\t\tredis: {\r\n\t\t\t\t\thost: redisHost,\r\n\t\t\t\t\tport: redisPort,\r\n\t\t\t\t\tpassword: redisPassword,\r\n\t\t\t\t\tdb: redisDb,\r\n\t\t\t\t\tttl: redisTtl,\r\n\t\t\t\t\tmaxRetries: redisMaxRetries,\r\n\t\t\t\t\tretryDelayOnFailover: redisRetryDelay,\r\n\t\t\t\t},\r\n\t\t\t\tfile: {\r\n\t\t\t\t\tdirectory: fileDirectory,\r\n\t\t\t\t\tmaxSize: fileMaxSize,\r\n\t\t\t\t\tcleanupInterval: fileCleanupInterval,\r\n\t\t\t\t},\r\n\t\t\t\twarming: {\r\n\t\t\t\t\tenabled: warmingEnabled,\r\n\t\t\t\t\twarmupOnStart: warmingOnStart,\r\n\t\t\t\t\tmaxFilesToWarm: warmingMaxFiles,\r\n\t\t\t\t\twarmupCron: warmingCron,\r\n\t\t\t\t\tpopularImageThreshold: warmingThreshold,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tprocessing: {\r\n\t\t\t\tmaxConcurrent: processingMaxConcurrent,\r\n\t\t\t\ttimeout: processingTimeout,\r\n\t\t\t\tretries: processingRetries,\r\n\t\t\t\tmaxFileSize: processingMaxFileSize,\r\n\t\t\t\tallowedFormats,\r\n\t\t\t},\r\n\t\t\tmonitoring: {\r\n\t\t\t\tenabled: monitoringEnabled,\r\n\t\t\t\tmetricsPort: monitoringMetricsPort,\r\n\t\t\t\thealthPath: monitoringHealthPath,\r\n\t\t\t\tmetricsPath: monitoringMetricsPath,\r\n\t\t\t},\r\n\t\t\texternalServices: {\r\n\t\t\t\tdjangoUrl,\r\n\t\t\t\tnuxtUrl,\r\n\t\t\t\trequestTimeout: externalRequestTimeout,\r\n\t\t\t\tmaxRetries: externalMaxRetries,\r\n\t\t\t},\r\n\t\t\trateLimit: {\r\n\t\t\t\tenabled: rateLimitEnabled,\r\n\t\t\t\tdefault: {\r\n\t\t\t\t\twindowMs: rateLimitDefaultWindowMs,\r\n\t\t\t\t\tmax: rateLimitDefaultMax,\r\n\t\t\t\t},\r\n\t\t\t\timageProcessing: {\r\n\t\t\t\t\twindowMs: rateLimitImageProcessingWindowMs,\r\n\t\t\t\t\tmax: rateLimitImageProcessingMax,\r\n\t\t\t\t},\r\n\t\t\t\thealthCheck: {\r\n\t\t\t\t\twindowMs: rateLimitHealthCheckWindowMs,\r\n\t\t\t\t\tmax: rateLimitHealthCheckMax,\r\n\t\t\t\t},\r\n\t\t\t\tbypass: {\r\n\t\t\t\t\thealthChecks: rateLimitBypassHealthChecks,\r\n\t\t\t\t\tmetricsEndpoint: rateLimitBypassMetricsEndpoint,\r\n\t\t\t\t\tstaticAssets: rateLimitBypassStaticAssets,\r\n\t\t\t\t\twhitelistedDomains: rateLimitBypassWhitelistedDomains,\r\n\t\t\t\t\tbots: rateLimitBypassBots,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateHotReloadableSettings(newConfig: AppConfig): void {\r\n\t\tif (this.isHotReloadable('MONITORING_ENABLED')) {\r\n\t\t\tthis.config.monitoring.enabled = newConfig.monitoring.enabled\r\n\t\t}\r\n\r\n\t\tif (this.isHotReloadable('PROCESSING_MAX_CONCURRENT')) {\r\n\t\t\tthis.config.processing.maxConcurrent = newConfig.processing.maxConcurrent\r\n\t\t}\r\n\r\n\t\tif (this.isHotReloadable('CACHE_MEMORY_TTL')) {\r\n\t\t\tthis.config.cache.memory.defaultTtl = newConfig.cache.memory.defaultTtl\r\n\t\t}\r\n\r\n\t\tif (this.isHotReloadable('CACHE_FILE_CLEANUP_INTERVAL')) {\r\n\t\t\tthis.config.cache.file.cleanupInterval = newConfig.cache.file.cleanupInterval\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["Injectable","Logger","ConfigService","NestConfigService","nestConfigService","_logger","name","hotReloadableKeys","Set","config","loadAndValidateConfig","onModuleInit","log","get","key","keys","split","value","k","undefined","Error","getOptional","defaultValue","getAll","validate","plainToClass","AppConfigDto","rawConfig","createRawConfigForValidation","dto","enableImplicitConversion","excludeExtraneousValues","errors","whitelist","forbidNonWhitelisted","length","errorMessages","map","error","Object","values","constraints","join","server","port","host","cors","origin","methods","maxAge","cache","memory","maxSize","defaultTtl","checkPeriod","maxKeys","warningThreshold","redis","password","db","ttl","maxRetries","retryDelayOnFailover","file","directory","cleanupInterval","warming","enabled","warmupOnStart","maxFilesToWarm","warmupCron","popularImageThreshold","processing","maxConcurrent","timeout","retries","maxFileSize","allowedFormats","monitoring","metricsPort","healthPath","metricsPath","externalServices","djangoUrl","nuxtUrl","requestTimeout","http","retryDelay","circuitBreaker","failureThreshold","resetTimeout","healthCheck","urls","rateLimit","default","windowMs","max","imageProcessing","bypass","healthChecks","metricsEndpoint","staticAssets","whitelistedDomains","bots","reload","newConfig","loadConfig","updateHotReloadableSettings","isHotReloadable","has","serverPort","Number","parseInt","serverHost","corsOrigin","corsMethods","corsMaxAge","memoryMaxSize","memoryDefaultTtl","memoryCheckPeriod","memoryMaxKeys","memoryWarningThreshold","redisHost","redisPort","redisPassword","redisDb","redisTtl","redisMaxRetries","redisRetryDelay","fileDirectory","fileMaxSize","fileCleanupInterval","warmingEnabledStr","warmingEnabled","toLowerCase","warmingOnStartStr","warmingOnStart","warmingMaxFiles","warmingCron","warmingThreshold","processingMaxConcurrent","processingTimeout","processingRetries","processingMaxFileSize","allowedFormatsStr","format","trim","monitoringEnabledStr","monitoringEnabled","monitoringMetricsPort","monitoringHealthPath","monitoringMetricsPath","externalRequestTimeout","externalMaxRetries","rateLimitEnabledStr","rateLimitEnabled","rateLimitDefaultWindowMs","rateLimitDefaultMax","rateLimitImageProcessingWindowMs","rateLimitImageProcessingMax","rateLimitHealthCheckWindowMs","rateLimitHealthCheckMax","rateLimitBypassHealthChecksStr","rateLimitBypassHealthChecks","rateLimitBypassMetricsEndpointStr","rateLimitBypassMetricsEndpoint","rateLimitBypassStaticAssetsStr","rateLimitBypassStaticAssets","rateLimitBypassWhitelistedDomains","rateLimitBypassBotsStr","rateLimitBypassBots"],"mappings":"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"}
{"version":3,"sources":["../../../../src/MediaStream/RateLimit/rate-limit.module.ts"],"sourcesContent":["import { ConfigModule } from '@microservice/Config/config.module'\r\nimport { ConfigService } from '@microservice/Config/config.service'\r\nimport { MetricsModule } from '@microservice/Metrics/metrics.module'\r\nimport { Module } from '@nestjs/common'\r\nimport { ThrottlerModule } from '@nestjs/throttler'\r\nimport { AdaptiveRateLimitGuard } from './guards/adaptive-rate-limit.guard'\r\nimport { RateLimitMetricsService } from './services/rate-limit-metrics.service'\r\nimport { RateLimitService } from './services/rate-limit.service'\r\n\r\n@Module({\r\n\timports: [\r\n\t\tConfigModule,\r\n\t\tMetricsModule,\r\n\t\tThrottlerModule.forRootAsync({\r\n\t\t\timports: [ConfigModule],\r\n\t\t\tinject: [ConfigService],\r\n\t\t\tuseFactory: (_configService: ConfigService) => ({\r\n\t\t\t\tthrottlers: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'default',\r\n\t\t\t\t\t\tttl: _configService.getOptional('rateLimit.default.windowMs', 60000),\r\n\t\t\t\t\t\tlimit: _configService.getOptional('rateLimit.default.max', 500),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'image-processing',\r\n\t\t\t\t\t\tttl: _configService.getOptional('rateLimit.imageProcessing.windowMs', 60000),\r\n\t\t\t\t\t\tlimit: _configService.getOptional('rateLimit.imageProcessing.max', 300),\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tskipIf: (context) => {\r\n\t\t\t\t\tconst request = context.switchToHttp().getRequest()\r\n\t\t\t\t\treturn request.url?.startsWith('/health')\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t}),\r\n\t],\r\n\tproviders: [RateLimitService, AdaptiveRateLimitGuard, RateLimitMetricsService],\r\n\texports: [RateLimitService, AdaptiveRateLimitGuard, RateLimitMetricsService],\r\n})\r\nexport class RateLimitModule {}\r\n"],"names":["ConfigModule","ConfigService","MetricsModule","Module","ThrottlerModule","AdaptiveRateLimitGuard","RateLimitMetricsService","RateLimitService","RateLimitModule","imports","forRootAsync","inject","useFactory","_configService","throttlers","name","ttl","getOptional","limit","skipIf","context","request","switchToHttp","getRequest","url","startsWith","providers","exports"],"mappings":";;;;;;AAAA,SAASA,YAAY,QAAQ,6BAAoC;AACjE,SAASC,aAAa,QAAQ,8BAAqC;AACnE,SAASC,aAAa,QAAQ,+BAAsC;AACpE,SAASC,MAAM,QAAQ,iBAAgB;AACvC,SAASC,eAAe,QAAQ,oBAAmB;AACnD,SAASC,sBAAsB,QAAQ,wCAAoC;AAC3E,SAASC,uBAAuB,QAAQ,2CAAuC;AAC/E,SAASC,gBAAgB,QAAQ,mCAA+B;AAgChE,OAAO,MAAMC;AAAiB;;;QA7B7BC,SAAS;YACRT;YACAE;YACAE,gBAAgBM,YAAY,CAAC;gBAC5BD,SAAS;oBAACT;iBAAa;gBACvBW,QAAQ;oBAACV;iBAAc;gBACvBW,YAAY,CAACC,iBAAmC,CAAA;wBAC/CC,YAAY;4BACX;gCACCC,MAAM;gCACNC,KAAKH,eAAeI,WAAW,CAAC,8BAA8B;gCAC9DC,OAAOL,eAAeI,WAAW,CAAC,yBAAyB;4BAC5D;4BACA;gCACCF,MAAM;gCACNC,KAAKH,eAAeI,WAAW,CAAC,sCAAsC;gCACtEC,OAAOL,eAAeI,WAAW,CAAC,iCAAiC;4BACpE;yBACA;wBACDE,QAAQ,CAACC;4BACR,MAAMC,UAAUD,QAAQE,YAAY,GAAGC,UAAU;4BACjD,OAAOF,QAAQG,GAAG,EAAEC,WAAW;wBAChC;oBACD,CAAA;YACD;SACA;QACDC,WAAW;YAACnB;YAAkBF;YAAwBC;SAAwB;QAC9EqB,SAAS;YAACpB;YAAkBF;YAAwBC;SAAwB"}
{"version":3,"sources":["../../../src/MediaStream/media-stream.module.ts"],"sourcesContent":["import type { MiddlewareConsumer, NestModule } from '@nestjs/common'\r\nimport MediaStreamImageRESTController from '@microservice/API/controllers/media-stream-image-rest.controller'\r\nimport { CacheModule } from '@microservice/Cache/cache.module'\r\nimport CacheImageResourceOperation from '@microservice/Cache/operations/cache-image-resource.operation'\r\nimport { MediaStreamExceptionFilter } from '@microservice/common/filters/media-stream-exception.filter'\r\nimport { ConfigModule } from '@microservice/Config/config.module'\r\nimport { CorrelationModule } from '@microservice/Correlation/correlation.module'\r\nimport { CorrelationMiddleware } from '@microservice/Correlation/middleware/correlation.middleware'\r\nimport { TimingMiddleware } from '@microservice/Correlation/middleware/timing.middleware'\r\nimport { CorrelationService } from '@microservice/Correlation/services/correlation.service'\r\nimport { HealthModule } from '@microservice/Health/health.module'\r\nimport { HttpModule } from '@microservice/HTTP/http.module'\r\nimport { MetricsModule } from '@microservice/Metrics/metrics.module'\r\nimport { MetricsMiddleware } from '@microservice/Metrics/middleware/metrics.middleware'\r\nimport { MonitoringModule } from '@microservice/Monitoring/monitoring.module'\r\nimport FetchResourceResponseJob from '@microservice/Queue/jobs/fetch-resource-response.job'\r\nimport GenerateResourceIdentityFromRequestJob from '@microservice/Queue/jobs/generate-resource-identity-from-request.job'\r\nimport StoreResourceResponseToFileJob from '@microservice/Queue/jobs/store-resource-response-to-file.job'\r\nimport WebpImageManipulationJob from '@microservice/Queue/jobs/webp-image-manipulation.job'\r\nimport { QueueModule } from '@microservice/Queue/queue.module'\r\nimport { AdaptiveRateLimitGuard } from '@microservice/RateLimit/guards/adaptive-rate-limit.guard'\r\nimport { RateLimitModule } from '@microservice/RateLimit/rate-limit.module'\r\nimport { StorageModule } from '@microservice/Storage/storage.module'\r\nimport { TasksModule } from '@microservice/Tasks/tasks.module'\r\nimport ValidateCacheImageRequestResizeTargetRule from '@microservice/Validation/rules/validate-cache-image-request-resize-target.rule'\r\nimport ValidateCacheImageRequestRule from '@microservice/Validation/rules/validate-cache-image-request.rule'\r\nimport { ValidationModule } from '@microservice/Validation/validation.module'\r\nimport { Module } from '@nestjs/common'\r\nimport { APP_FILTER, APP_GUARD, HttpAdapterHost } from '@nestjs/core'\r\nimport { ScheduleModule } from '@nestjs/schedule'\r\n\r\nconst controllers = [MediaStreamImageRESTController]\r\n\r\nconst operations = [CacheImageResourceOperation]\r\n\r\nconst jobs = [\r\n\tGenerateResourceIdentityFromRequestJob,\r\n\tFetchResourceResponseJob,\r\n\tStoreResourceResponseToFileJob,\r\n\tWebpImageManipulationJob,\r\n]\r\n\r\nconst rules = [ValidateCacheImageRequestRule, ValidateCacheImageRequestResizeTargetRule]\r\n\r\n/**\r\n * The Main module for the MediaStream application\r\n * Configures all controllers, providers, and global filters/interceptors\r\n */\r\n@Module({\r\n\timports: [\r\n\t\tConfigModule,\r\n\t\tCacheModule,\r\n\t\tCorrelationModule,\r\n\t\tHealthModule,\r\n\t\tHttpModule,\r\n\t\tMetricsModule,\r\n\t\tMonitoringModule,\r\n\t\tQueueModule,\r\n\t\tRateLimitModule,\r\n\t\tStorageModule,\r\n\t\tTasksModule,\r\n\t\tValidationModule,\r\n\t\tScheduleModule.forRoot(),\r\n\t],\r\n\tcontrollers,\r\n\tproviders: [\r\n\t\t...jobs,\r\n\t\t...rules,\r\n\t\t...operations,\r\n\t\t{\r\n\t\t\tprovide: APP_FILTER,\r\n\t\t\tuseFactory: (httpAdapterHost: HttpAdapterHost, _correlationService: CorrelationService) => {\r\n\t\t\t\treturn new MediaStreamExceptionFilter(httpAdapterHost, _correlationService)\r\n\t\t\t},\r\n\t\t\tinject: [HttpAdapterHost, CorrelationService],\r\n\t\t},\r\n\t\t{\r\n\t\t\tprovide: APP_GUARD,\r\n\t\t\tuseClass: AdaptiveRateLimitGuard,\r\n\t\t},\r\n\t],\r\n})\r\nexport default class MediaStreamModule implements NestModule {\r\n\tconfigure(consumer: MiddlewareConsumer): void {\r\n\t\tconsumer\r\n\t\t\t.apply(CorrelationMiddleware, TimingMiddleware, MetricsMiddleware)\r\n\t\t\t.forRoutes('*')\r\n\t}\r\n}\r\n"],"names":["MediaStreamImageRESTController","CacheModule","CacheImageResourceOperation","MediaStreamExceptionFilter","ConfigModule","CorrelationModule","CorrelationMiddleware","TimingMiddleware","CorrelationService","HealthModule","HttpModule","MetricsModule","MetricsMiddleware","MonitoringModule","FetchResourceResponseJob","GenerateResourceIdentityFromRequestJob","StoreResourceResponseToFileJob","WebpImageManipulationJob","QueueModule","AdaptiveRateLimitGuard","RateLimitModule","StorageModule","TasksModule","ValidateCacheImageRequestResizeTargetRule","ValidateCacheImageRequestRule","ValidationModule","Module","APP_FILTER","APP_GUARD","HttpAdapterHost","ScheduleModule","controllers","operations","jobs","rules","MediaStreamModule","configure","consumer","apply","forRoutes","imports","forRoot","providers","provide","useFactory","httpAdapterHost","_correlationService","inject","useClass"],"mappings":";;;;;;AACA,OAAOA,oCAAoC,0DAAkE;AAC7G,SAASC,WAAW,QAAQ,0BAAkC;AAC9D,OAAOC,iCAAiC,uDAA+D;AACvG,SAASC,0BAA0B,QAAQ,oDAA4D;AACvG,SAASC,YAAY,QAAQ,4BAAoC;AACjE,SAASC,iBAAiB,QAAQ,sCAA8C;AAChF,SAASC,qBAAqB,QAAQ,qDAA6D;AACnG,SAASC,gBAAgB,QAAQ,gDAAwD;AACzF,SAASC,kBAAkB,QAAQ,gDAAwD;AAC3F,SAASC,YAAY,QAAQ,4BAAoC;AACjE,SAASC,UAAU,QAAQ,wBAAgC;AAC3D,SAASC,aAAa,QAAQ,8BAAsC;AACpE,SAASC,iBAAiB,QAAQ,6CAAqD;AACvF,SAASC,gBAAgB,QAAQ,oCAA4C;AAC7E,OAAOC,8BAA8B,8CAAsD;AAC3F,OAAOC,4CAA4C,8DAAsE;AACzH,OAAOC,oCAAoC,sDAA8D;AACzG,OAAOC,8BAA8B,8CAAsD;AAC3F,SAASC,WAAW,QAAQ,0BAAkC;AAC9D,SAASC,sBAAsB,QAAQ,kDAA0D;AACjG,SAASC,eAAe,QAAQ,mCAA2C;AAC3E,SAASC,aAAa,QAAQ,8BAAsC;AACpE,SAASC,WAAW,QAAQ,0BAAkC;AAC9D,OAAOC,+CAA+C,wEAAgF;AACtI,OAAOC,mCAAmC,0DAAkE;AAC5G,SAASC,gBAAgB,QAAQ,oCAA4C;AAC7E,SAASC,MAAM,QAAQ,iBAAgB;AACvC,SAASC,UAAU,EAAEC,SAAS,EAAEC,eAAe,QAAQ,eAAc;AACrE,SAASC,cAAc,QAAQ,mBAAkB;AAEjD,MAAMC,cAAc;IAAC/B;CAA+B;AAEpD,MAAMgC,aAAa;IAAC9B;CAA4B;AAEhD,MAAM+B,OAAO;IACZlB;IACAD;IACAE;IACAC;CACA;AAED,MAAMiB,QAAQ;IAACV;IAA+BD;CAA0C;AAwCxF,eAAe,MAAMY;IACpBC,UAAUC,QAA4B,EAAQ;QAC7CA,SACEC,KAAK,CAAChC,uBAAuBC,kBAAkBK,mBAC/C2B,SAAS,CAAC;IACb;AACD;;;QAvCCC,SAAS;YACRpC;YACAH;YACAI;YACAI;YACAC;YACAC;YACAE;YACAK;YACAE;YACAC;YACAC;YACAG;YACAK,eAAeW,OAAO;SACtB;QACDV;QACAW,WAAW;eACPT;eACAC;eACAF;YACH;gBACCW,SAAShB;gBACTiB,YAAY,CAACC,iBAAkCC;oBAC9C,OAAO,IAAI3C,2BAA2B0C,iBAAiBC;gBACxD;gBACAC,QAAQ;oBAAClB;oBAAiBrB;iBAAmB;YAC9C;YACA;gBACCmC,SAASf;gBACToB,UAAU7B;YACX;SACA"}
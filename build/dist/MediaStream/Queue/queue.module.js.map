{"version":3,"sources":["../../../../src/MediaStream/Queue/queue.module.ts"],"sourcesContent":["import { BullModule } from '@nestjs/bull'\r\nimport { Module } from '@nestjs/common'\r\nimport { ConfigModule, ConfigService } from '@nestjs/config'\r\nimport { TerminusModule } from '@nestjs/terminus'\r\nimport { CacheModule } from '../Cache/cache.module'\r\nimport { CorrelationModule } from '../Correlation/correlation.module'\r\nimport { HttpModule } from '../HTTP/http.module'\r\nimport { JobQueueHealthIndicator } from './indicators/job-queue-health.indicator'\r\nimport { CacheOperationsProcessor } from './processors/cache-operations.processor'\r\nimport { ImageProcessingProcessor } from './processors/image-processing.processor'\r\nimport { BullQueueService } from './services/bull-queue.service'\r\nimport { JobQueueManager } from './services/job-queue.manager'\r\n\r\n@Module({\r\n\timports: [\r\n\t\tBullModule.forRootAsync({\r\n\t\t\timports: [ConfigModule],\r\n\t\t\tuseFactory: async (_configService: ConfigService) => ({\r\n\t\t\t\tredis: {\r\n\t\t\t\t\thost: _configService.get('REDIS_HOST', 'localhost'),\r\n\t\t\t\t\tport: _configService.get('REDIS_PORT', 6379),\r\n\t\t\t\t\tpassword: _configService.get('REDIS_PASSWORD'),\r\n\t\t\t\t\tdb: _configService.get('REDIS_DB', 0),\r\n\t\t\t\t\tretryDelayOnFailover: 100,\r\n\t\t\t\t\tenableReadyCheck: false,\r\n\t\t\t\t\tmaxRetriesPerRequest: 3,\r\n\t\t\t\t},\r\n\t\t\t\tdefaultJobOptions: {\r\n\t\t\t\t\tremoveOnComplete: 10,\r\n\t\t\t\t\tremoveOnFail: 5,\r\n\t\t\t\t\tattempts: 3,\r\n\t\t\t\t\tbackoff: {\r\n\t\t\t\t\t\ttype: 'exponential',\r\n\t\t\t\t\t\tdelay: 2000,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t\tinject: [ConfigService],\r\n\t\t}),\r\n\t\tBullModule.registerQueue(\r\n\t\t\t{\r\n\t\t\t\tname: 'image-processing',\r\n\t\t\t\tdefaultJobOptions: {\r\n\t\t\t\t\tremoveOnComplete: 10,\r\n\t\t\t\t\tremoveOnFail: 5,\r\n\t\t\t\t\tattempts: 3,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: 'cache-operations',\r\n\t\t\t\tdefaultJobOptions: {\r\n\t\t\t\t\tremoveOnComplete: 5,\r\n\t\t\t\t\tremoveOnFail: 3,\r\n\t\t\t\t\tattempts: 2,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t),\r\n\t\tCorrelationModule,\r\n\t\tHttpModule,\r\n\t\tCacheModule,\r\n\t\tTerminusModule,\r\n\t],\r\n\tproviders: [\r\n\t\tBullQueueService,\r\n\t\tJobQueueManager,\r\n\t\tImageProcessingProcessor,\r\n\t\tCacheOperationsProcessor,\r\n\t\tJobQueueHealthIndicator,\r\n\t],\r\n\texports: [\r\n\t\tJobQueueManager,\r\n\t\tJobQueueHealthIndicator,\r\n\t],\r\n})\r\nexport class QueueModule {}\r\n"],"names":["BullModule","Module","ConfigModule","ConfigService","TerminusModule","CacheModule","CorrelationModule","HttpModule","JobQueueHealthIndicator","CacheOperationsProcessor","ImageProcessingProcessor","BullQueueService","JobQueueManager","QueueModule","imports","forRootAsync","useFactory","_configService","redis","host","get","port","password","db","retryDelayOnFailover","enableReadyCheck","maxRetriesPerRequest","defaultJobOptions","removeOnComplete","removeOnFail","attempts","backoff","type","delay","inject","registerQueue","name","providers","exports"],"mappings":";;;;;;AAAA,SAASA,UAAU,QAAQ,eAAc;AACzC,SAASC,MAAM,QAAQ,iBAAgB;AACvC,SAASC,YAAY,EAAEC,aAAa,QAAQ,iBAAgB;AAC5D,SAASC,cAAc,QAAQ,mBAAkB;AACjD,SAASC,WAAW,QAAQ,2BAAuB;AACnD,SAASC,iBAAiB,QAAQ,uCAAmC;AACrE,SAASC,UAAU,QAAQ,yBAAqB;AAChD,SAASC,uBAAuB,QAAQ,6CAAyC;AACjF,SAASC,wBAAwB,QAAQ,6CAAyC;AAClF,SAASC,wBAAwB,QAAQ,6CAAyC;AAClF,SAASC,gBAAgB,QAAQ,mCAA+B;AAChE,SAASC,eAAe,QAAQ,kCAA8B;AA+D9D,OAAO,MAAMC;AAAa;;;QA5DzBC,SAAS;YACRd,WAAWe,YAAY,CAAC;gBACvBD,SAAS;oBAACZ;iBAAa;gBACvBc,YAAY,OAAOC,iBAAmC,CAAA;wBACrDC,OAAO;4BACNC,MAAMF,eAAeG,GAAG,CAAC,cAAc;4BACvCC,MAAMJ,eAAeG,GAAG,CAAC,cAAc;4BACvCE,UAAUL,eAAeG,GAAG,CAAC;4BAC7BG,IAAIN,eAAeG,GAAG,CAAC,YAAY;4BACnCI,sBAAsB;4BACtBC,kBAAkB;4BAClBC,sBAAsB;wBACvB;wBACAC,mBAAmB;4BAClBC,kBAAkB;4BAClBC,cAAc;4BACdC,UAAU;4BACVC,SAAS;gCACRC,MAAM;gCACNC,OAAO;4BACR;wBACD;oBACD,CAAA;gBACAC,QAAQ;oBAAC/B;iBAAc;YACxB;YACAH,WAAWmC,aAAa,CACvB;gBACCC,MAAM;gBACNT,mBAAmB;oBAClBC,kBAAkB;oBAClBC,cAAc;oBACdC,UAAU;gBACX;YACD,GACA;gBACCM,MAAM;gBACNT,mBAAmB;oBAClBC,kBAAkB;oBAClBC,cAAc;oBACdC,UAAU;gBACX;YACD;YAEDxB;YACAC;YACAF;YACAD;SACA;QACDiC,WAAW;YACV1B;YACAC;YACAF;YACAD;YACAD;SACA;QACD8B,SAAS;YACR1B;YACAJ;SACA"}
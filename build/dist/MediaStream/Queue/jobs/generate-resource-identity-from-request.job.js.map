{"version":3,"sources":["../../../../../src/MediaStream/Queue/jobs/generate-resource-identity-from-request.job.ts"],"sourcesContent":["import type CacheImageRequest from '@microservice/API/dto/cache-image-request.dto'\r\nimport type { ResourceIdentifierKP } from '@microservice/common/constants/key-properties.constant'\r\nimport { Buffer } from 'node:buffer'\r\nimport { createHash } from 'node:crypto'\r\nimport { Injectable, Scope } from '@nestjs/common'\r\n\r\nconst NAMESPACE_URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8'\r\n\r\nfunction generateUUIDv5(name: string, namespace: string = NAMESPACE_URL): string {\r\n\tconst ns = Buffer.from(namespace.replace(/-/g, ''), 'hex')\r\n\tconst hash = createHash('sha1').update(Buffer.concat([ns, Buffer.from(name)])).digest()\r\n\r\n\thash[6] = (hash[6] & 0x0F) | 0x50\r\n\thash[8] = (hash[8] & 0x3F) | 0x80\r\n\r\n\tconst hex = hash.subarray(0, 16).toString('hex')\r\n\treturn (\r\n\t\t`${hex.substring(0, 8)}-`\r\n\t\t+ `${hex.substring(8, 12)}-`\r\n\t\t+ `${hex.substring(12, 16)}-`\r\n\t\t+ `${hex.substring(16, 20)}-`\r\n\t\t+ `${hex.substring(20)}`\r\n\t)\r\n}\r\n\r\n@Injectable({ scope: Scope.REQUEST })\r\nexport default class GenerateResourceIdentityFromRequestJob {\r\n\tasync handle(cacheImageRequest: CacheImageRequest): Promise<ResourceIdentifierKP> {\r\n\t\tconst request = JSON.parse(JSON.stringify(cacheImageRequest))\r\n\t\tconst requestStr = JSON.stringify(request)\r\n\t\treturn generateUUIDv5(requestStr)\r\n\t}\r\n}\r\n"],"names":["Buffer","createHash","Injectable","Scope","NAMESPACE_URL","generateUUIDv5","name","namespace","ns","from","replace","hash","update","concat","digest","hex","subarray","toString","substring","GenerateResourceIdentityFromRequestJob","handle","cacheImageRequest","request","JSON","parse","stringify","requestStr","scope","REQUEST"],"mappings":";;;;;;AAEA,SAASA,MAAM,QAAQ,cAAa;AACpC,SAASC,UAAU,QAAQ,cAAa;AACxC,SAASC,UAAU,EAAEC,KAAK,QAAQ,iBAAgB;AAElD,MAAMC,gBAAgB;AAEtB,SAASC,eAAeC,IAAY,EAAEC,YAAoBH,aAAa;IACtE,MAAMI,KAAKR,OAAOS,IAAI,CAACF,UAAUG,OAAO,CAAC,MAAM,KAAK;IACpD,MAAMC,OAAOV,WAAW,QAAQW,MAAM,CAACZ,OAAOa,MAAM,CAAC;QAACL;QAAIR,OAAOS,IAAI,CAACH;KAAM,GAAGQ,MAAM;IAErFH,IAAI,CAAC,EAAE,GAAG,AAACA,IAAI,CAAC,EAAE,GAAG,OAAQ;IAC7BA,IAAI,CAAC,EAAE,GAAG,AAACA,IAAI,CAAC,EAAE,GAAG,OAAQ;IAE7B,MAAMI,MAAMJ,KAAKK,QAAQ,CAAC,GAAG,IAAIC,QAAQ,CAAC;IAC1C,OACC,GAAGF,IAAIG,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,GACvB,GAAGH,IAAIG,SAAS,CAAC,GAAG,IAAI,CAAC,CAAC,GAC1B,GAAGH,IAAIG,SAAS,CAAC,IAAI,IAAI,CAAC,CAAC,GAC3B,GAAGH,IAAIG,SAAS,CAAC,IAAI,IAAI,CAAC,CAAC,GAC3B,GAAGH,IAAIG,SAAS,CAAC,KAAK;AAE1B;AAGe,IAAA,AAAMC,yCAAN,MAAMA;IACpB,MAAMC,OAAOC,iBAAoC,EAAiC;QACjF,MAAMC,UAAUC,KAAKC,KAAK,CAACD,KAAKE,SAAS,CAACJ;QAC1C,MAAMK,aAAaH,KAAKE,SAAS,CAACH;QAClC,OAAOjB,eAAeqB;IACvB;AACD;AANA,SAAqBP,oDAMpB;;;QAPaQ,OAAOxB,MAAMyB,OAAO"}
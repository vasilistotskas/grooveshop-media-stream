{"version":3,"sources":["../../../../../src/MediaStream/Queue/jobs/fetch-resource-response.job.ts"],"sourcesContent":["import type CacheImageRequest from '@microservice/API/dto/cache-image-request.dto'\r\nimport type { AxiosResponse } from 'axios'\r\nimport { HttpService } from '@nestjs/axios'\r\nimport { Injectable, Logger, Scope } from '@nestjs/common'\r\nimport { isAxiosError } from 'axios'\r\n\r\n@Injectable({ scope: Scope.REQUEST })\r\nexport default class FetchResourceResponseJob {\r\n\tprivate readonly _logger = new Logger(FetchResourceResponseJob.name)\r\n\tconstructor(private readonly _httpService: HttpService) {\r\n\t\tthis._logger.debug('HttpService has been injected successfully')\r\n\t}\r\n\r\n\tasync handle(request: CacheImageRequest): Promise<AxiosResponse> {\r\n\t\ttry {\r\n\t\t\treturn await this._httpService.axiosRef({\r\n\t\t\t\turl: request.resourceTarget,\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\tresponseType: 'stream',\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch (error: unknown) {\r\n\t\t\tif (isAxiosError(error)) {\r\n\t\t\t\tthis._logger.error(error.toJSON())\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstatus: error.response?.status ?? 404,\r\n\t\t\t\t\tstatusText: error.response?.statusText ?? 'Bad Request',\r\n\t\t\t\t\theaders: {},\r\n\t\t\t\t\tconfig: error.config || {} as any,\r\n\t\t\t\t\tdata: null,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._logger.error('Unknown error occurred while fetching resource')\r\n\t\t\t\tthrow error\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["HttpService","Injectable","Logger","Scope","isAxiosError","FetchResourceResponseJob","_httpService","_logger","name","debug","handle","request","axiosRef","url","resourceTarget","method","responseType","error","toJSON","status","response","statusText","headers","config","data","scope","REQUEST"],"mappings":";;;;;;;;;AAEA,SAASA,WAAW,QAAQ,gBAAe;AAC3C,SAASC,UAAU,EAAEC,MAAM,EAAEC,KAAK,QAAQ,iBAAgB;AAC1D,SAASC,YAAY,QAAQ,QAAO;AAGpC,eAAe,MAAMC;IAEpB,YAAY,AAAiBC,YAAyB,CAAE;aAA3BA,eAAAA;aADZC,UAAU,IAAIL,OAAOG,yBAAyBG,IAAI;QAElE,IAAI,CAACD,OAAO,CAACE,KAAK,CAAC;IACpB;IAEA,MAAMC,OAAOC,OAA0B,EAA0B;QAChE,IAAI;YACH,OAAO,MAAM,IAAI,CAACL,YAAY,CAACM,QAAQ,CAAC;gBACvCC,KAAKF,QAAQG,cAAc;gBAC3BC,QAAQ;gBACRC,cAAc;YACf;QACD,EACA,OAAOC,OAAgB;YACtB,IAAIb,aAAaa,QAAQ;gBACxB,IAAI,CAACV,OAAO,CAACU,KAAK,CAACA,MAAMC,MAAM;gBAC/B,OAAO;oBACNC,QAAQF,MAAMG,QAAQ,EAAED,UAAU;oBAClCE,YAAYJ,MAAMG,QAAQ,EAAEC,cAAc;oBAC1CC,SAAS,CAAC;oBACVC,QAAQN,MAAMM,MAAM,IAAI,CAAC;oBACzBC,MAAM;gBACP;YACD,OACK;gBACJ,IAAI,CAACjB,OAAO,CAACU,KAAK,CAAC;gBACnB,MAAMA;YACP;QACD;IACD;AACD;;;QAhCcQ,OAAOtB,MAAMuB,OAAO"}